<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Ficha de Inscrição da Comunidade</title>

    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- Bootstrap Icons (Tailwind não inclui ícones) -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet"/>
    
    <!-- CSS Personalizado (Fontes, Estilos de Erro, Alertas e Spinners customizados) -->
    <style type="text/css">
        /* Fonte Inter */
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
        }
        
        /* Estilo para placeholder de select (quando value="") */
        .form-select:invalid {
            color: #6c757d;
        }
        .form-select option {
            color: #333;
        }

        /* Estilo para placeholder de date */
        .form-control[type="date"]:invalid,
        .form-control[type="date"]::placeholder {
            color: #6c757d;
            opacity: 1;
        }

        /* Classe de erro de validação (para sobrepor o border-none do Tailwind) */
        .input-error {
            border: 1px solid #dc3545 !important;
            box-shadow: 0 0 0 0.25rem rgba(220, 53, 69, 0.25) !important;
        }
        .custom-select-wrapper .input-error {
             border-right: none !important; /* Mantém a seta de select intacta */
        }

        /* --- Substitutos para Alertas Bootstrap --- */
        .form-feedback-box {
            padding: 1rem;
            border-radius: 0.375rem;
            border: 1px solid transparent;
            margin-bottom: 1rem;
            position: relative;
            opacity: 1;
            transition: opacity 0.15s linear;
        }
        .feedback-success {
            background-color: #d1e7dd;
            border-color: #badbcc;
            color: #0a3622;
        }
        .feedback-danger {
            background-color: #f8d7da;
            border-color: #f5c2c7;
            color: #58151c;
        }
        .feedback-close-btn {
            background: transparent;
            border: 0;
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1;
            color: #000;
            opacity: 0.5;
            position: absolute;
            top: 0.5rem;
            right: 0.75rem;
            cursor: pointer;
        }
        .feedback-close-btn:hover {
            opacity: 0.75;
        }
        .feedback-close-btn::before {
            content: '×'; /* 'x' de multiplicação */
        }
        /* --- Fim dos Alertas --- */

        /* --- Substituto para Spinner Bootstrap --- */
        .loading-spinner {
            display: inline-block;
            width: 1rem;
            height: 1rem;
            vertical-align: text-bottom;
            border: 0.15em solid currentColor;
            border-right-color: transparent;
            border-radius: 50%;
            animation: 0.75s linear infinite spinner-border;
            margin-right: 0.5rem;
        }
        @keyframes spinner-border {
            to { transform: rotate(360deg); }
        }
        /* --- Fim do Spinner --- */
    </style>
</head>
<body class="bg-white text-gray-800">

    <!-- Logo -->
    <div class="container mx-auto px-4 py-4 flex justify-center md:justify-start md:py-6">
        <img src="/imgs/e09e28c5018183995db4d302e9628b4d6ae6cfd9.png" class="h-auto max-w-[180px] md:max-w-[240px]" alt="Logo da Comunidade">
    </div>

    <!-- Título do Formulário -->
    <header class="bg-[#003366] text-white p-3 text-center font-bold text-base tracking-wider uppercase md:text-xl md:p-4">
        FICHA DE INSCRIÇÃO DA COMUNIDADE
    </header>

    <!-- Container Principal do Formulário -->
    <main class="container mx-auto px-3 md:px-4 pb-8 md:pb-16 max-w-5xl">
        
        <!-- Container de Feedback (JS) -->
        <div id="form-feedback" class="mt-4 w-full" aria-live="polite"></div>

        <form id="form-comunidade" method="POST" action="/formulario/cadastro/comunidade/" novalidate>
            
            <input type="hidden" name="csrfmiddlewaretoken" value="TOKEN_GERADO_PELO_DJANGO_AQUI">

            <!-- Seção Dados Pessoais -->
            <h3 class="font-bold text-lg text-gray-900 mt-6 mb-4 md:text-xl md:mt-8 md:mb-6">Dados Pessoais do Inscrito</h3>
            <div class="flex flex-wrap -mx-3">
                
                <!-- Coluna Esquerda -->
                <div class="w-full md:w-1/2 px-3">
                    <div class="mb-4">
                        <label for="nome_inscrito" class="sr-only">Nome Completo</label>
                        <input type="text" id="nome_inscrito" name="nome_inscrito" class="apenas-letras form-control block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="Nome Completo" required autocomplete="name">
                    </div>
                    <div class="mb-4">
                        <label for="data_nascimento" class="sr-only">Data de Nascimento</label>
                        <input type="date" class="form-control block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" id="data_nascimento" name="data_nascimento" required autocomplete="bday">
                    </div>
                    <div class="mb-4">
                        <label for="cpf_inscrito" class="sr-only">CPF</label>
                        <input type="text" id="cpf_inscrito" name="cpf_inscrito" class="cpf form-control block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="CPF" required maxlength="14" autocomplete="off">
                    </div>
                    <div class="mb-4">
                        <label for="telefone_inscrito" class="sr-only">Telefone Celular</label>
                        <input type="text" id="telefone_inscrito" name="telefone_inscrito" class="telefone form-control block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="Telefone Celular" required maxlength="15" autocomplete="tel">
                    </div>
                    <div class="mb-4">
                        <label for="email_inscrito" class="sr-only">E-mail</label>
                        <input type="email" class="form-control email block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" id="email_inscrito" name="email_inscrito" placeholder="E-mail" required autocomplete="email">
                    </div>
                    
                    <!-- Selects Customizados -->
                    <div class="custom-select-wrapper relative mb-4">
                        <label for="identidade_genero" class="sr-only">Identidade de Gênero</label>
                        <select class="form-select block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base appearance-none pr-12" id="identidade_genero" name="identidade_genero" required>
                            <option value="" selected disabled>Identidade de Gênero</option>
                            <option value="masculino">Masculino</option>
                            <option value="feminino">Feminino</option>
                            <option value="naobinario">Não-binário</option>
                            <option value="transgenero">Transgênero</option>
                            <option value="outro">Outro</option>
                            <option value="pref-nao-dizer">Prefiro não dizer</option>
                        </select>
                        <div class="custom-arrow absolute top-0 right-0 bottom-0 w-10 bg-[#003366] text-white flex items-center justify-center pointer-events-none rounded-r-md text-lg md:w-12"><i class="bi bi-caret-down-fill" aria-hidden="true"></i></div>
                    </div>
                    <div class="custom-select-wrapper relative mb-4">
                        <label for="cor_etnia" class="sr-only">Cor e Etnia</label>
                        <select class="form-select block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base appearance-none pr-12" id="cor_etnia" name="cor_etnia" required>
                            <option value="" selected disabled>Cor e Etnia</option>
                            <option value="branca">Branca</option>
                            <option value="preta">Preta</option>
                            <option value="parda">Parda</option>
                            <option value="amarela">Amarela</option>
                            <option value="indigena">Indígena</option>
                            <option value="outra">Outra</option>
                        </select>
                        <div class="custom-arrow absolute top-0 right-0 bottom-0 w-10 bg-[#003366] text-white flex items-center justify-center pointer-events-none rounded-r-md text-lg md:w-12"><i class="bi bi-caret-down-fill" aria-hidden="true"></i></div>
                    </div>
                    <div class="custom-select-wrapper relative mb-4">
                        <label for="religiao" class="sr-only">Religião</label>
                        <select class="form-select block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base appearance-none pr-12" id="religiao" name="religiao" required>
                            <option value="" selected disabled>Religião</option>
                            <option value="catolica">Católica</option>
                            <option value="evangelica">Evangélica</option>
                            <option value="budismo">Budismo</option>
                            <option value="espirita">Espírita</option>
                            <option value="hinduismo">Hinduísmo</option>
                            <option value="islamismo">Islamismo</option>
                            <option value="judaismo">Judaísmo</option>
                            <option value="matriz-afro">Religião de Matriz Africana</option>
                            <option value="outra">Outra</option>
                            <option value="nenhuma">Nenhuma / Agnóstico / Ateu</option>
                        </select>
                        <div class="custom-arrow absolute top-0 right-0 bottom-0 w-10 bg-[#003366] text-white flex items-center justify-center pointer-events-none rounded-r-md text-lg md:w-12"><i class="bi bi-caret-down-fill" aria-hidden="true"></i></div>
                    </div>
                    <div class="custom-select-wrapper relative mb-4">
                        <label for="estado_civil_inscrito" class="sr-only">Estado Civil</label>
                        <select class="form-select block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base appearance-none pr-12" id="estado_civil_inscrito" name="estado_civil_inscrito" required>
                            <option value="" selected disabled>Estado Civil</option>
                            <option value="solteiro">Solteiro(a)</option>
                            <option value="casado">Casado(a)</option>
                            <option value="divorciado">Divorciado(a)</option>
                            <option value="viuvo">Viúvo(a)</option>
                            <option value="uniao-estavel">União Estável</option>
                            <option value="nenhum">Nenhum</option>
                            <option value="outros">Outros</option>
                        </select>
                        <div class="custom-arrow absolute top-0 right-0 bottom-0 w-10 bg-[#003366] text-white flex items-center justify-center pointer-events-none rounded-r-md text-lg md:w-12"><i class="bi bi-caret-down-fill" aria-hidden="true"></i></div>
                    </div>
                    <div class="custom-select-wrapper relative mb-4">
                        <label for="motivos_acompanhamento" class="sr-only">Motivos da Busca do Tratamento/Acompanhamento Psicológico</label>
                        <select class="form-select block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base appearance-none pr-12" id="motivos_acompanhamento" name="motivos_acompanhamento" required>
                            <option value="" selected disabled>Motivos da Busca do Tratamento/Acompanhamento Psicológico</option>
                            <option value="ansiedade">Ansiedade</option>
                            <option value="assediomoral">Assédio Moral</option>
                            <option value="depressao">Depressão</option>
                            <option value="dfaprendizagem">Dificuldade de Aprendizagem</option>
                            <option value="humorinstavel">Humor Instável</option>
                            <option value="insonia">Insônia</option>
                            <option value="isolasocial">Isolamento Social</option>
                            <option value="luto">Luto</option>
                            <option value="tristeza">Tristeza</option>
                            <option value="apatia">Apatia</option>
                            <option value="exaustao">Exaustão</option>
                            <option value="fadiga">Fadiga</option>
                            <option value="faltanimo">Falta Ânimo</option>
                            <option value="assediosexual">Assédio Sexual</option>
                            <option value="outro">Outro</option>
                        </select>
                        <div class="custom-arrow absolute top-0 right-0 bottom-0 w-10 bg-[#003366] text-white flex items-center justify-center pointer-events-none rounded-r-md text-lg md:w-12"><i class="bi bi-caret-down-fill" aria-hidden="true"></i></div>
                    </div>
                </div>

                <!-- Coluna Direita -->
                <div class="w-full md:w-1/2 px-3">
                    <div class="custom-select-wrapper relative mb-4">
                        <label for="medicamentos_usados" class="sr-only">Uso de Medicação</label>
                        <select class="form-select block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base appearance-none pr-12" id="medicamentos_usados" name="medicamentos_usados" required>
                            <option value="" selected disabled>Uso de Medicação</option>
                            <option value="ansiolitico">Ansiolítico</option>
                            <option value="antidepressivo">Antidepressivo</option>
                            <option value="antipsicotico">Antipsicótico</option>
                            <option value="estabhumor">Estabilizador de Humor</option>
                            <option value="memoriatct">Medicamentos para memória, atenção e concentração</option>
                            <option value="nenhum">Nenhum</option>
                            <option value="outro">Outro</option>
                        </select>
                        <div class="custom-arrow absolute top-0 right-0 bottom-0 w-10 bg-[#003366] text-white flex items-center justify-center pointer-events-none rounded-r-md text-lg md:w-12"><i class="bi bi-caret-down-fill" aria-hidden="true"></i></div>
                    </div>
                    <div class="custom-select-wrapper relative mb-4">
                        <label for="pcd_neurodivergente" class="sr-only">Pessoa com Deficiência e/ou Neurodivergências</label>
                        <select class="form-select block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base appearance-none pr-12" id="pcd_neurodivergente" name="pcd_neurodivergente" required>
                            <option value="" selected disabled>Pessoa com Deficiência e/ou Neurodivergências</option>
                            <option value="tea">TEA (Transtorno do Espectro Autista)</option>
                            <option value="tdah">TDAH (Transtorno do Déficit de Atenção com Hiperatividade)</option>
                            <option value="def_fisica">Deficiência Física</option>
                            <option value="def_visual">Deficiência Visual</option>
                            <option value="def_auditiva">Deficiência Auditiva</option>
                            <option value="transtorno_aprendizagem">Transtornos de Aprendizagem (Dislexia, etc.)</option>
                            <option value="altas_habilidades">Altas Habilidades / Superdotação</option>
                            <option value="nenhum">Nenhum</option>
                            <option value="outro">Outro</option>
                        </select>
                        <div class="custom-arrow absolute top-0 right-0 bottom-0 w-10 bg-[#003366] text-white flex items-center justify-center pointer-events-none rounded-r-md text-lg md:w-12"><i class="bi bi-caret-down-fill" aria-hidden="true"></i></div>
                    </div>
                    <div class="custom-select-wrapper relative mb-4">
                        <label for="doencas_fisicas" class="sr-only">Doenças Físicas Diagnosticadas</label>
                        <select class="form-select block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base appearance-none pr-12" id="doencas_fisicas" name="doencas_fisicas" required>
                            <option value="" selected disabled>Doenças Físicas Diagnosticadas</option>
                            <option value="doencaresp">Doenças respiratórias</option>
                            <option value="cancer">Câncer</option>
                            <option value="diabete">Diabetes</option>
                            <option value="disfusexul">Disfunções sexuais</option>
                            <option value="doencadgt">Doenças degenerativas</option>
                            <option value="escleorosemlt">Esclerose múltipla</option>
                            <option value="hcpt">Hipertensão ou cardiopatias</option>
                            <option value="luposatm">Lúpus ou outras doenças autoimunes</option>
                            <option value="obesidade">Obesidade</option>
                            <option value="pblmarenal">Problemas renais</option>
                            <option value="nenhum">Nenhum</option>
                            <option value="outro">Outro</option>
                        </select>
                        <div class="custom-arrow absolute top-0 right-0 bottom-0 w-10 bg-[#003366] text-white flex items-center justify-center pointer-events-none rounded-r-md text-lg md:w-12"><i class="bi bi-caret-down-fill" aria-hidden="true"></i></div>
                    </div>
                    <div class="custom-select-wrapper relative mb-4">
                        <label for="tipo_terapias" class="sr-only">Tipo de Terapia</label>
                        <select class="form-select block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base appearance-none pr-12" id="tipo_terapias" name="tipo_terapias" required>
                            <option value="" selected disabled>Tipo de Terapia</option>
                            <option value="individual">Individual</option>
                            <option value="grupo">Grupo</option>
                            <option value="casal">Casal</option>
                            <option value="familia">Família</option>
                        </select>
                        <div class="custom-arrow absolute top-0 right-0 bottom-0 w-10 bg-[#003366] text-white flex items-center justify-center pointer-events-none rounded-r-md text-lg md:w-12"><i class="bi bi-caret-down-fill" aria-hidden="true"></i></div>
                    </div>
                    <div class="custom-select-wrapper relative mb-4">
                        <label for="disponibilidade" class="sr-only">Disponibilidade</label>
                        <select class="form-select block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base appearance-none pr-12" id="disponibilidade" name="disponibilidade" required>
                            <option value="" selected disabled>Disponibilidade</option>
                            <option value="manha_semana">Manhã (Segunda a Sexta)</option>
                            <option value="tarde_semana">Tarde (Segunda a Sexta)</option>
                            <option value="noite_semana">Noite (Segunda a Sexta)</option>
                            <option value="sabado_manha">Sábado (Somente pela manhã, 8:30h às 12h)</option>
                        </select>
                        <div class="custom-arrow absolute top-0 right-0 bottom-0 w-10 bg-[#003366] text-white flex items-center justify-center pointer-events-none rounded-r-md text-lg md:w-12"><i class="bi bi-caret-down-fill" aria-hidden="true"></i></div>
                    </div>
                    <div class="mb-4">
                        <label for="rua" class="sr-only">Rua</label>
                        <input type="text" id="rua" name="rua" class="form-control block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="Rua" required autocomplete="address-line1">
                    </div>
                    <div class="mb-4">
                        <label for="bairro" class="sr-only">Bairro</label>
                        <input type="text" id="bairro" name="bairro" class="form-control block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="Bairro" required autocomplete="address-level2">
                    </div>
                    <div class="mb-4">
                        <label for="cidade" class="sr-only">Cidade</label>
                        <input type="text" id="cidade" name="cidade" class="form-control block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="Cidade" required autocomplete="address-level2">
                    </div>
                    <div class="custom-select-wrapper relative mb-4">
                        <label for="uf" class="sr-only">UF</label>
                        <select class="form-select block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base appearance-none pr-12" id="uf" name="uf" required autocomplete="address-level1">
                            <option value="" selected disabled>UF</option>
                            <option value="DF">Distrito Federal</option>
                            <!-- Adicionar outros estados se necessário -->
                        </select>
                        <div class="custom-arrow absolute top-0 right-0 bottom-0 w-10 bg-[#003366] text-white flex items-center justify-center pointer-events-none rounded-r-md text-lg md:w-12"><i class="bi bi-caret-down-fill" aria-hidden="true"></i></div>
                    </div>
                    <div class="mb-4">
                        <label for="cep" class="sr-only">CEP</label>
                        <input type="text" id="cep" name="cep" class="form-control cep block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="CEP" required maxlength="9" autocomplete="postal-code">
                    </div>
                </div>
            </div>

            <!-- Checkbox Menor de Idade -->
            <div class="flex flex-wrap -mx-3">
                <div class="w-full px-3">
                    <div class="flex items-center gap-3 mt-6">
                        <label class="font-bold text-base md:text-lg order-1 text-gray-800 cursor-pointer" for="checkMenorIdade">
                            O Inscrito é menor de idade?
                        </label>
                        <input class="order-2 w-5 h-5 m-0 border border-gray-300 bg-gray-100 rounded focus:ring-offset-0 focus:ring-2 focus:ring-[#003366] checked:bg-[#003366] checked:border-[#003366] cursor-pointer md:w-6 md:h-6" type="checkbox" id="checkMenorIdade" name="menorIdade">
                    </div>
                </div>
            </div>

            <!-- Seção Dados do Responsável (Oculta por padrão) -->
            <div id="dadosResponsavel" class="hidden">
                <h3 class="font-bold text-lg text-gray-900 mt-6 mb-4 md:text-xl md:mt-8 md:mb-6">Dados do Responsável Legal</h3>
                <div class="flex flex-wrap -mx-3" id="secao-responsavel">
                    <div class="w-full md:w-1/2 px-3">
                        <div class="mb-4">
                            <label for="nome_responsavel" class="sr-only">Nome Completo do Responsável</label>
                            <input type="text" id="nome_responsavel" name="nome_responsavel" class="form-control apenas-letras block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="Nome Completo" autocomplete="name">
                        </div>
                        <div class="mb-4">
                             <label for="cpf_responsavel" class="sr-only">CPF do Responsável</label>
                            <input type="text" id="cpf_responsavel" name="cpf_responsavel" class="form-control cpf block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="CPF" maxlength="14" autocomplete="off">
                        </div>
                        <div class="mb-4">
                            <label for="telefone_responsavel" class="sr-only">Telefone Celular do Responsável</label>
                            <input type="text" id="telefone_responsavel" name="telefone_responsavel" class="form-control telefone block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="Telefone Celular" maxlength="15" autocomplete="tel">
                        </div>
                    </div>
                    <div class="w-full md:w-1/2 px-3">
                        <div class="mb-4">
                            <label for="email_responsavel" class="sr-only">E-mail do Responsável</label>
                            <input type="email" id="email_responsavel" class="form-control block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" name="email_responsavel" placeholder="E-mail" autocomplete="email">
                        </div>
                        <div class="custom-select-wrapper relative mb-4">
                            <label for="estado_civil_responsavel" class="sr-only">Estado Civil do Responsável</label>
                            <select class="form-select block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base appearance-none pr-12" id="estado_civil_responsavel" name="estado_civil_responsavel">
                                <option value="" selected disabled>Estado Civil</option>
                                <option value="solteiro">Solteiro(a)</option>
                                <option value="casado">Casado(a)</option>
                                <option value="divorciado">Divorciado(a)</option>
                                <option value="viuvo">Viúvo(a)</option>
                                <option value="uniao-estavel">União Estável</option>
                            </select>
                            <div class="custom-arrow absolute top-0 right-0 bottom-0 w-10 bg-[#003366] text-white flex items-center justify-center pointer-events-none rounded-r-md text-lg md:w-12"><i class="bi bi-caret-down-fill" aria-hidden="true"></i></div>
                        </div>
                        <div class="mb-4">
                            <label for="parentesco_responsavel" class="sr-only">Grau de Parentesco</label>
                            <input type="text" id="parentesco_responsavel" name="parentesco_responsavel" class="form-control apenas-letras block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="Grau de Parentesco">
                        </div>
                    </div>
                </div>
            </div>

            <!-- Seção Contatos de Urgência -->
            <h3 class="font-bold text-lg text-gray-900 mt-6 mb-4 md:text-xl md:mt-8 md:mb-6">Contato(s) de Urgência</h3>
            <div id="emergencyContactsContainer">
                <div class="contact-entry relative p-4 md:p-6 bg-gray-50 border border-gray-200 rounded-md mt-4"> 
                    <div class="flex flex-wrap -mx-3">
                        <h5 class="w-full px-3 font-bold text-base mt-0 mb-2 text-[#003366]">Contato 1</h5>
                        <div class="w-full md:w-1/2 px-3">
                            <div class="mb-4 md:mb-0">
                                <label for="nome_urgencia_1" class="sr-only">Nome Completo (Urgência)</label>
                                <input type="text" id="nome_urgencia_1" name="nome_urgencia[]" class="apenas-letras form-control block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="Nome Completo" required>
                            </div>
                        </div>
                        <div class="w-full md:w-1/2 px-3">
                             <div class="mb-0">
                                <label for="telefone_urgencia_1" class="sr-only">Telefone Celular (Urgência)</label>
                                <input type="text" id="telefone_urgencia_1" name="telefone_urgencia[]" class="telefone form-control block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="Telefone Celular" required maxlength="15">
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- Botão Adicionar Contato -->
            <div class="flex items-center gap-2 mt-4 mb-4">
                 <button type="button" class="add-contact-btn bg-[#003366] text-white border-none rounded-full w-8 h-8 text-lg flex items-center justify-center leading-none shadow-md transition-all duration-200 ease-in-out hover:bg-[#004a99] hover:scale-110" id="addContactBtn" aria-label="Adicionar outro contato de urgência">
                     <i class="bi bi-plus" aria-hidden="true"></i>
                 </button>
                 <span class="text-sm font-medium text-gray-700">Adicionar outro contato</span>
            </div>

            <!-- Seção LGPD -->
            <div class="bg-gray-100 border border-gray-200 p-4 md:p-6 mt-8 rounded-md">
                <p class="text-sm leading-relaxed text-gray-600 mb-4">
                    Ao preencher o presente formulário e submeter minha inscrição para atendimento na Clínica Escola de Psicologia do Unieuro, declaro que autorizo, em conformidade com o inciso I do art. 7, da Lei nº 13.709/2018 (Lei Geral de Proteção de Dados Pessoais – LGPD) que os dados pessoais aqui fornecidos sejam tratados e utilizados unicamente para a finalidade exclusiva de compor o banco de dados dos atendimentos a serem realizados sendo a ciência, o tratamento e o uso destes restrito aos membros da Clínica Escola de Psicologia, nos termos da LGPD.
                </p>
                <p class="text-sm leading-relaxed text-gray-600 mb-4">
                    Declaro ainda que tenho conhecimento de que a revogação da presente autorização poderá ser feita a qualquer momento, mediante solicitação formal a ser registrada pelo e-mail: psicologia@unieuro.edu.br
                </p>
                <div class="flex items-center gap-3 mt-6">
                    <label class="font-bold text-base md:text-lg order-1 text-gray-800 cursor-pointer" for="checkLGPD">
                        De Acordo
                    </label>
                    <input class="order-2 w-5 h-5 m-0 border border-gray-300 bg-gray-100 rounded focus:ring-offset-0 focus:ring-2 focus:ring-[#003366] checked:bg-[#003366] checked:border-[#003366] cursor-pointer md:w-6 md:h-6" type="checkbox" id="checkLGPD" name="deAcordo" required>
                </div>
            </div>

            <!-- Botão Salvar -->
            <div class="flex flex-wrap -mx-3 mt-12">
                <div class="w-full px-3 text-center">
                    <button type="submit" class="w-full bg-[#003366] border-none font-bold uppercase tracking-wider py-3.5 px-6 text-base rounded-md transition-all duration-200 ease-in-out hover:bg-[#004a99] hover:shadow-lg disabled:bg-[#004a99] disabled:opacity-70 disabled:cursor-wait md:w-auto md:min-w-[220px]" id="submit-button">
                        Salvar Inscrição
                    </button>
                </div>
            </div>

        </form>
    </main>
    
    <!-- JavaScript Embutido -->
    <script type="module">
        document.addEventListener('DOMContentLoaded', function () {

            const form = document.getElementById('form-comunidade');
            if (!form) {
                console.error("Erro Crítico: O formulário com ID 'form-comunidade' não foi encontrado.");
                return;
            }

            // --- Referências ---
            const submitButton = document.getElementById('submit-button');
            const formFeedback = document.getElementById('form-feedback');
            // ------------------------

            const csrfTokenInput = form.querySelector('[name=csrfmiddlewaretoken]');
            if (!csrfTokenInput || !csrfTokenInput.value) {
                console.warn('Input CSRF token não encontrado ou vazio. O envio para o Django falhará.');
            }
            const csrfToken = csrfTokenInput ? csrfTokenInput.value : '';

            const checkMenor = document.getElementById('checkMenorIdade');
            const dadosResponsavel = document.getElementById('dadosResponsavel');
            const inputsResponsavel = dadosResponsavel.querySelectorAll('input, select');

            function toggleResponsavel() {
                const isChecked = checkMenor.checked;
                // Usa classes 'hidden' e 'block' do Tailwind
                if (isChecked) {
                    dadosResponsavel.classList.remove('hidden');
                    dadosResponsavel.classList.add('block');
                } else {
                    dadosResponsavel.classList.remove('block');
                    dadosResponsavel.classList.add('hidden');
                }
                
                inputsResponsavel.forEach(input => {
                    input.required = isChecked;
                    if (!isChecked) {
                        input.value = ''; 
                        if(input.tagName === 'SELECT') {
                            updateSelectColor(input); 
                        }
                        input.classList.remove('input-error');
                        // Encontra o parente mais próximo que contém o campo
                        const parent = input.closest('.mb-4') || input.closest('.custom-select-wrapper');
                        const errorMsg = parent ? parent.querySelector('.error-message') : null;
                        if (errorMsg) errorMsg.remove();
                    }
                });
            }
            
            checkMenor.addEventListener('change', toggleResponsavel);
            toggleResponsavel(); // Executa ao carregar a página

            /**
             * Atualiza a cor do texto de um <select> com base se 
             * a opção "placeholder" (value="") está selecionada.
             */
            function updateSelectColor(select) {
                if (select.value === "") {
                    select.style.color = '#6c757d'; // Cor do placeholder
                } else {
                    select.style.color = '#333'; // Cor do texto
                }
            }
            
            document.querySelectorAll('.form-select').forEach(select => {
                select.addEventListener('change', () => updateSelectColor(select));
                updateSelectColor(select);
            });

            const contactsContainer = document.getElementById('emergencyContactsContainer');
            const addContactBtn = document.getElementById('addContactBtn');
            let contactCount = 1;

            addContactBtn.addEventListener('click', function () {
                contactCount++;
                const newContact = document.createElement('div');
                // Adiciona classes do Tailwind para o novo 'contact-entry'
                newContact.className = 'contact-entry relative p-4 md:p-6 bg-gray-50 border border-gray-200 rounded-md mt-4';
                newContact.innerHTML = `
                    <div class="flex flex-wrap -mx-3">
                        <h5 class="w-full px-3 font-bold text-base mt-0 mb-2 text-[#003366]">Contato ${contactCount}</h5>
                        <div class="w-full md:w-1/2 px-3">
                            <div class="mb-4 md:mb-0">
                                <label for="nome_urgencia_${contactCount}" class="sr-only">Nome Completo Contato ${contactCount}</label>
                                <input type="text" id="nome_urgencia_${contactCount}" name="nome_urgencia[]" class="apenas-letras form-control block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="Nome Completo" required>
                            </div>
                        </div>
                        <div class="w-full md:w-1/2 px-3">
                            <div class="mb-0">
                                <label for="telefone_urgencia_${contactCount}" class="sr-only">Telefone Celular Contato ${contactCount}</label>
                                <input type="text" id="telefone_urgencia_${contactCount}" name="telefone_urgencia[]" class="telefone form-control block w-full bg-gray-100 border-none rounded-md py-3 px-4 text-sm text-gray-800 focus:bg-gray-200 focus:outline-none focus:ring-2 focus:ring-[#003366] focus:ring-opacity-60 md:text-base" placeholder="Telefone Celular" required maxlength="15">
                            </div>
                        </div>
                    </div>
                    <button type="button" class="remove-contact-btn absolute top-2.5 right-2.5 bg-red-600 text-white border-none rounded-full w-8 h-8 text-lg flex items-center justify-center leading-none shadow-md transition-all duration-200 ease-in-out hover:bg-red-700 hover:scale-110" aria-label="Remover Contato ${contactCount}"><i class="bi bi-dash" aria-hidden="true"></i></button>
                `;
                contactsContainer.appendChild(newContact);
                
                // Adiciona formatação de máscara aos novos campos
                newContact.querySelectorAll('.telefone').forEach(input => {
                    input.addEventListener('input', (e) => e.target.value = formatTelefone(e.target.value));
                });
                newContact.querySelectorAll('.apenas-letras').forEach(input => {
                    input.addEventListener('input', (e) => e.target.value = e.target.value.replace(/[^\p{L}\s]/gu, ''));
                });
            });

            contactsContainer.addEventListener('click', function (e) {
                const removeBtn = e.target.closest('.remove-contact-btn');
                if (removeBtn) {
                    removeBtn.closest('.contact-entry').remove();
                    updateContactNumbers();
                }
            });

            function updateContactNumbers() {
                const allContacts = contactsContainer.querySelectorAll('.contact-entry');
                allContacts.forEach((contact, index) => {
                    const title = contact.querySelector('h5');
                    if (title) title.textContent = `Contato ${index + 1}`;
                    
                    const removeBtn = contact.querySelector('.remove-contact-btn');
                    if(removeBtn) removeBtn.setAttribute('aria-label', `Remover Contato ${index + 1}`);

                    const nomeInput = contact.querySelector('input[name="nome_urgencia[]"]');
                    const nomeLabel = contact.querySelector(`label[for^="nome_urgencia_"]`);
                    if(nomeInput) nomeInput.id = `nome_urgencia_${index + 1}`;
                    if(nomeLabel) nomeLabel.setAttribute('for', `nome_urgencia_${index + 1}`);

                    const telInput = contact.querySelector('input[name="telefone_urgencia[]"]');
                    const telLabel = contact.querySelector(`label[for^="telefone_urgencia_"]`);
                    if(telInput) telInput.id = `telefone_urgencia_${index + 1}`;
                    if(telLabel) telLabel.setAttribute('for', `telefone_urgencia_${index + 1}`);
                });
                contactCount = allContacts.length;
            }

            /**
             * Exibe uma mensagem de feedback no topo do formulário.
             * @param {'success' | 'danger'} type - O tipo de alerta.
             * @param {string} message - A mensagem HTML para exibir.
             */
            function showMessage(type, message) {
                const alertDiv = document.createElement('div');
                // Usa as novas classes CSS personalizadas
                alertDiv.className = `form-feedback-box feedback-${type}`;
                alertDiv.setAttribute('role', 'alert');
                alertDiv.innerHTML = `
                    ${message}
                    <button type="button" class="feedback-close-btn" aria-label="Close"></button>
                `;
                
                formFeedback.innerHTML = ''; // Limpa mensagens antigas
                formFeedback.appendChild(alertDiv);
                
                alertDiv.scrollIntoView({ behavior: 'smooth', block: 'center' });
            }

            // --- NOVO: Listener para fechar os alertas customizados ---
            formFeedback.addEventListener('click', function(e) {
                const closeButton = e.target.closest('.feedback-close-btn');
                if (closeButton) {
                    const alertBox = closeButton.closest('.form-feedback-box');
                    // Adiciona um efeito de fade out simples
                    alertBox.style.opacity = '0';
                    setTimeout(() => alertBox.remove(), 150);
                }
            });

            /** Limpa todos os erros de validação da tela. */
            function clearErrors() {
                form.querySelectorAll('.error-message').forEach(el => el.remove());
                form.querySelectorAll('.input-error').forEach(el => {
                    el.classList.remove('input-error');
                });
                formFeedback.innerHTML = '';
            }

            /**
             * Exibe erros de validação do backend nos campos correspondentes.
             * @param {Object} erros - Um objeto onde a chave é o 'id' do campo e o valor é um array de mensagens.
             */
            function displayErrors(erros) {
                console.log("Erros de validação do Django:", erros);
                
                let firstErrorField = null;

                for (const [fieldName, errorMessages] of Object.entries(erros)) {
                    let campo = document.getElementById(fieldName);
                    
                    if (!campo && fieldName.includes('[]')) {
                        campo = form.querySelector(`[name="${fieldName}"]`);
                    } else if (!campo) {
                        campo = form.querySelector(`[name="${fieldName}"]`);
                    }
                    
                    if (campo) {
                        if (!firstErrorField) firstErrorField = campo;
                        
                        campo.classList.add('input-error');
                        
                        const erroEl = document.createElement('span');
                        erroEl.className = 'error-message text-red-600 text-sm mt-1 block'; // Adiciona classes Tailwind
                        erroEl.textContent = errorMessages.join(' '); 
                        
                        // Insere após o campo ou wrapper
                        const parentWrapper = campo.closest('.custom-select-wrapper') || campo.closest('.mb-4') || campo.parentNode;
                        // Insere após o último elemento no wrapper (como a seta do select)
                        parentWrapper.appendChild(erroEl);

                    } else {
                        console.warn(`Campo de erro '${fieldName}' não encontrado no DOM.`);
                    }
                }
                
                showMessage('danger', '<strong>Erro de validação:</strong> Por favor, verifique os campos destacados.');

                if (firstErrorField) {
                    firstErrorField.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            form.addEventListener('submit', async function(event) {
                event.preventDefault(); 
                clearErrors(); 

                // --- Estado de Loading (usa nova classe de spinner) ---
                submitButton.disabled = true;
                submitButton.innerHTML = `
                    <span class="loading-spinner" role="status" aria-hidden="true"></span>
                    Enviando...
                `;
                
                const formData = new FormData(form);
                const dadosObjeto = {};
                
                const keys = new Set();
                for (const key of formData.keys()) {
                    keys.add(key);
                }

                for (const key of keys) {
                    if (key === 'csrfmiddlewaretoken') continue;

                    if (key.endsWith('[]')) {
                        const cleanKey = key.slice(0, -2);
                        dadosObjeto[cleanKey] = formData.getAll(key);
                    } else {
                        dadosObjeto[key] = formData.get(key);
                    }
                }

                dadosObjeto.menorIdade = checkMenor.checked;
                dadosObjeto.deAcordo = document.getElementById('checkLGPD').checked;

                console.log("Dados a serem enviados (JSON):", dadosObjeto);

                try {
                    const response = await fetch(form.action, { 
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                            'X-CSRFToken': csrfToken 
                        },
                        body: JSON.stringify(dadosObjeto)
                    });

                    const resultado = await response.json();

                    if (response.ok) {
                        showMessage('success', `<strong>Sucesso!</strong> ${resultado.mensagem || 'Inscrição realizada com sucesso!'}`);
                        
                        form.reset();
                        
                        document.querySelectorAll('.form-select').forEach(updateSelectColor);
                        toggleResponsavel(); 
                        
                        const extraContacts = contactsContainer.querySelectorAll('.contact-entry:not(:first-child)');
                        extraContacts.forEach(contact => contact.remove());
                        updateContactNumbers();

                    } else if (resultado.status === 'erro_validacao') {
                        displayErrors(resultado.erros);
                    } else {
                        showMessage('danger', `Erro do servidor: ${resultado.mensagem || 'Erro desconhecido.'}`);
                    }

                } catch (error) {
                    console.error('Erro de comunicação:', error);
                    showMessage('danger', 'Ocorreu um erro de comunicação com o servidor. Tente novamente mais tarde.');
                } finally {
                    submitButton.disabled = false;
                    submitButton.innerHTML = 'Salvar Inscrição';
                }
            });
            
            // --- Funções de Formatação (Máscaras) ---
            // (Sem alterações, são independentes de framework)

            function formatCPF(value) {
                const digits = value.replace(/\D/g, '').slice(0, 11);
                if (digits.length <= 3) return digits;
                if (digits.length <= 6) return digits.replace(/(\d{3})(\d)/, '$1.$2');
                if (digits.length <= 9) return digits.replace(/(\d{3})(\d{3})(\d)/, '$1.$2.$3');
                return digits.replace(/(\d{3})(\d{3})(\d{3})(\d{1,2})/, '$1.$2.$3-$4');
            }

            function formatTelefone(value) {
                const digits = value.replace(/\D/g, '').slice(0, 11);
                if (digits.length <= 2) return digits;
                if (digits.length <= 7) return digits.replace(/(\d{2})(\d)/, '($1) $2');
                if (digits.length <= 10) return digits.replace(/(\d{2})(\d{4})(\d{4})/, '($1) $2-$3'); // Fixo
                return digits.replace(/(\d{2})(\d{5})(\d{4})/, '($1) $2-$3'); // Celular
            }

            function formatCEP(value) {
                const digits = value.replace(/\D/g, '').slice(0, 8);
                if (digits.length <= 5) return digits;
                return digits.replace(/(\d{5})(\d{1,3})/, '$1-$2');
            }

            form.addEventListener('input', function(e) {
                const target = e.target;

                if (target.classList.contains('input-error')) {
                    target.classList.remove('input-error');
                    const parent = target.closest('.custom-select-wrapper') || target.closest('.mb-4') || target.parentNode;
                    const errorMsg = parent ? parent.querySelector('.error-message') : null;
                    if (errorMsg) errorMsg.remove();
                }

                if (target.classList.contains('cpf')) {
                    target.value = formatCPF(target.value);
                }
                
                if (target.classList.contains('telefone')) {
                    target.value = formatTelefone(target.value);
                }

                if (target.classList.contains('cep')) {
                    target.value = formatCEP(target.value);
                }

                if (target.classList.contains('apenas-letras')) {
                    target.value = target.value.replace(/[^\p{L}\s]/gu, '');
                }
            });

            form.addEventListener('change', function(e) {
                 const target = e.target;
                 if (target.tagName === 'SELECT' && target.classList.contains('input-error')) {
                    target.classList.remove('input-error');
                    const errorMsg = target.closest('.custom-select-wrapper').querySelector('.error-message');
                    if (errorMsg) errorMsg.remove();
                 }
            });

        });
    </script>
</body>
</html>

